---
title: "Random Forest"
author: "Haripriya"
date: "12 July 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MASS)
library(randomForest)
```

setting the seed so we get sAME RESULTS each time

```{r}
set.seed(123)
d=birthwt
#help("birthwt")
#View(d)
```

low=target variable

```{r}
str(d)
```

find the unique values

```{r}
apply(d,2,function(x) length(unique(x)))
```

highest age group is between 20-25

```{r}
hist(d$age)
```

-> some columns are ctegorical
-> For categorical : use as.factor [a split(best combination of levels) on a factor with N levels is actually a selection of one of 2^(n-2) possible combinations ]
-> For numerical : numerical values are sorted and then split to minimize gini impurity or entropy

```{r}
cols=c(1,4,5,6,7,8,9)
for(i in cols)
{
  d[,i]=as.factor(d[,i])
}

str(d)

```

create train and test dataset

```{r}
library(caTools)
i=sample.split(Y=d$low,SplitRatio = 0.7)
train=d[i,]
test=d[!i,]
```

Fitting the model

```{r}
model=randomForest(low~.,data=train,mtry=3,ntree=60)
model
```

OOB error=0 [good]

```{r}
importance(model)
```

```{r}
varImpPlot(model)
```

predictions

```{r}
pre=predict(model,test,type = "class")
pre
```

```{r}
t=table(pred=pre,act=test$low)
t
```
Accuracy

```{r}
sum(diag(t))/sum(t)
```
plot ROC curve and calculate AUC metric

```{r}
library(pROC)
#predict with probability
p=predict(model,test,type = 'prob')
p
```

```{r}
a=auc(test$low,p[,2])
a
```

```{r}
plot(roc(test$low,p[,2]))
```

Best mtry value

```{r}
#b=tuneRF(train,train$low,ntreeTry = 20,stepFactor = 1.5,improve = 0.01,trace = T,plot = T)
```




























